name: ðŸš€ Quick Tests (Development)

# Fast feedback workflow for development
on:
  push:
    branches: [ feat/*, feature/*, fix/*, hotfix/*, feat/unit-and-functional-tests ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

env:
  PYTHONPATH: /usr/lib/python3/dist-packages:/usr/share/qgis/python

jobs:
  quick-test:
    runs-on: ubuntu-latest
    name: âš¡ Quick Validation
    
    steps:
    - name: ðŸ“¥ Checkout Code
      uses: actions/checkout@v4
    
    - name: ðŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: ðŸ–¥ï¸ Install System Dependencies (Minimal)
      run: |
        sudo apt-get update
        sudo apt-get install -y xvfb python3-qgis qgis
    
    - name: ðŸ“¦ Cache Dependencies
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-quick-${{ hashFiles('**/requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-quick-
    
    - name: ðŸ”§ Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pytest-xvfb
    
    - name: ðŸ§ª Run Core Tests (Fast)
      run: |
        xvfb-run -a python -m pytest \
          tests/unit/test_crop_model.py \
          tests/unit/test_config.py \
          tests/unit/test_plugin.py \
          --verbose \
          --cov \
          --cov-report=term-missing \
          --timeout=180
      env:
        QT_QPA_PLATFORM: offscreen
        QGIS_PREFIX_PATH: /usr
        ENVIRONMENT: test
    
    - name: âœ… Success Notification
      run: |
        echo "## âš¡ Quick Test Results" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Core functionality validated successfully!" >> $GITHUB_STEP_SUMMARY
        echo "ðŸ”— For full CI/CD pipeline, merge to develop branch." >> $GITHUB_STEP_SUMMARY 